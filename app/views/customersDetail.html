<div ng-include="'views/layout/header.html'"></div>
<div ng-include="'views/layout/navigation.html'"></div>
<style>
    .pad{
        margin-top: 20px;
    }
    .mad{
        margin-top: 30px;
    }

    #mapid { height:500px; border:1px solid red; }
</style>

<div class="progress" ng-show="loading">
    <div class="indeterminate"></div>
</div>
<div ng-hide="loading">
    <div class="row">
        <div class="col s3">
            <h4><small>{{customer.FullName}}</small></h4>
        </div>
        <div class="col s3 mad  hide-print">
            <a class=" btn waves-effect waves-light teal lighten-2 tooltipped " data-position="bottom" data-delay="50" data-tooltip="Edit Infromations"><i class="medium material-icons ">mode_edit</i></a>
            <a class=" btn waves-effect waves-light red lighten-2 tooltipped" data-position="bottom" data-delay="50" data-tooltip="Delete customer"><i class="medium material-icons ">delete</i></a>
            <a class=" btn waves-effect waves-light blue darken-1 tooltipped " data-position="bottom" data-delay="50" data-tooltip="Add Intervention"><i class="medium material-icons">insert_chart</i></a>
        </div>
        <div class="col s6 pad  hide-print">
           <div class="center-align">
                <ul class="tabs  ">
                    <li class="tab col s1"><a class="active" href="#intervention">Interventions</a></li>
                    <li class="tab col s1"><a href="#locations">Locations</a></li>
                    <li class="tab col s1"><a href="#devices">Devices</a></li>
                    <li class="tab col s1"><a href="#projects">Projects</a></li>
                    <li class="tab col s1 disabled"><a href="#factures">Factures</a></li>
                </ul>
           </div>
        </div>
    </div>

    <div class="divider"></div>

    <section>
    <div class="row">


        <div id="details" class="col s12">
            <div class="col s3">
                <div class="row">
                    <h5>Principal adress <a class="btn-floating btn waves-effect waves-light blue darken-1 right"><i class="material-icons small">mode_edit</i></a></h5>
                    <div class="divider"></div>
                    <p><i class="material-icons tiny">location_on</i> {{customer.Adress}}</p>
                </div>

                <div class="row">
                    <h5>Contact</h5>
                    <div class="divider"></div>
                    <p><i class="material-icons tiny ">email</i> {{customer.Email}}</p>
                    <p><i class="material-icons tiny">call</i> {{customer.Phone}}</p>
                    <p><i class="material-icons tiny">call</i> {{customer.Mobile}}</p>

                </div>

                <div class="row">
                    <div class="divider"></div>
                    <p><img class="materialboxed center-align" width="200" src="http://placehold.it/200x120&text=Signature"></p>
                </div>
            </div>

            <div id="intervention" class="col s9">
                <table class="striped responsive-table">
                    <thead>
                    <tr>
                        <th data-field="interventions">Interventions</th>
                        <th data-field="status">Status</th>
                        <th data-field="location">Location</th>
                        <th data-field="technicians">Technicians</th>
                        <th data-field="date">Start Date</th>
                        <th data-field="date">End Date</th>
                    </tr>
                    </thead>

                    <tbody>
                    <tr ng-repeat="intervention in interventionsCustomer">
                        <td><a ui-sref="interventionDetails({id: {{intervention.Id}} })">{{intervention.Name}}</a></td>
                        <td class="new badge">4</td>
                        <td>{{customer.Adress}}</td>
                        <td>{{intervention.Group.Name}}</td>
                        <td>{{intervention.StartDate | date:'yyyy-MMM-dd'}}</td>
                        <td>{{intervention.EndDate | date:'yyyy-MMM-dd'}}</td>
                    </tr>

                    </tbody>
                </table>
            </div>

            <div id="locations" class="col s9">
                <div id="mapid"></div>
                <script>

                    //var a  = $('#lala');
                    //console.log(a);
                   /* var scope = angular.element($("body")).scope();
                    console.log(scope.$$childHead);*/



                    var map = L.map('mapid').setView([-18.980595, 47.539415], 13);

                    L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
                    }).addTo(map);


                    L.marker([-18.980595, 47.539415]).addTo(map)
                            .bindPopup('{{customer.Adress}}')
                            .openPopup();
                </script>

            </div>

            <div id="devices" class="container col s9">

                <table class="striped responsive-table">
                    <thead>
                    <tr>
                        <th>Name</th>
                        <th>Serial</th>
                        <th>Imei</th>
                        <th>Last test</th>
                        <th>Others Informations</th>
                        <th></th>

                    </tr>
                    </thead>

                    <tbody>
                    <tr ng-repeat="device in devicesCustomer">
                        <td>{{device.Name}}</td>
                        <td>{{device.Serial}}</td>
                        <td>{{device.Imei}}</td>
                        <td>{{device.Tests[0].Remarks}}</td>
                        <td>
                            <span class="chip" ng-repeat="add in device.AdditionalAttributes">{{add.Name}}: {{add.Value}}</span>
                        </td>
                        <td>

                            <a class=" btn waves-effect waves-light teal lighten-2 "><i class="large material-icons ">mode_edit</i></a>
                            <a class=" btn waves-effect waves-light red lighten-2 "><i class="large material-icons ">delete</i></a>

                        </td>
                    </tr>

                    </tbody>
                </table>

            </div>

            <div id="projects" class="col s9">
                <table class="striped responsive-table">
                    <thead>
                    <tr>
                        <th>Name</th>
                        <th>Description</th>
                        <th>Start date</th>
                        <th>End Date</th>
                        <th></th>

                    </tr>
                    </thead>

                    <tbody>
                    <tr ng-repeat="project in projectsCustomer">
                        <td><a ui-sref="projectDetails({id: {{project.Id}} })">{{project.Name}}</a></td>
                        <td>{{project.Description}}</td>
                        <td>{{project.StartDate}}</td>
                        <td>{{project.EndDate}}</td>
                        <td>

                            <a class=" btn waves-effect waves-light teal lighten-2 "><i class="large material-icons ">mode_edit</i></a>
                            <a class=" btn waves-effect waves-light red lighten-2 "><i class="large material-icons ">delete</i></a>

                        </td>
                    </tr>

                    </tbody>
                </table>
            </div>

            <div id="factures" class="col s9">

            </div>

        </div>

    </div>
</section>
</div>

<script>

    $(document).ready(function(){
        $('ul.tabs').tabs();
        $('.tooltipped').tooltip({delay: 50});
    });

</script>